
import Head from 'next/head';
import styles from '../styles/modules/Headphones.module.css';

import { MongoClient } from 'mongodb';
import { ProductQkView } from '../src/components/ProductQkView';
import { Header } from '../src/components/Header';
import { Menu } from '../src/components/Menu';
import { About } from '../src/components/About';
import { Footer } from '../src/components/Footer';


export default function Speakers({data}) {

    return (
        <div className={styles.page}>

	<Head>
	    <title>Speakers | Audiophile</title>
	  <meta
            name="description"
            content="Generated by create next app" />
	    <link rel="icon" href="/favicon.ico" />
	</Head>
          <header>
            <Header />
          </header>
          <main>
	    <section>
		<ProductQkView data={data}/>
	    </section>
            <section>
              <Menu />
            </section>
            <section>
              <About/>
            </section>
	  </main>
          <footer>
            <Footer />
          </footer>
	</div>
    )
} 

export const getStaticProps = async () => {

  const client = await MongoClient.connect(process.env.MONGODB_URI);

  const db = client.db('audiophile');

  const yourCollection = db.collection('product');

    let cursor = await yourCollection.find({category: "speakers"});
    let data = []

    await cursor.forEach(entry => {
        entry._id = entry._id.toString();
        data.push(entry)
    })

    cursor.close()

  return {
      props: {
          data
      }
  };
}
